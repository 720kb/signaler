{ LESSOPEN: '| /usr/bin/lesspipe %s',
  npm_config_cache_lock_stale: '60000',
  GNOME_KEYRING_PID: '8943',
  npm_config_sign_git_tag: '',
  USER: 'dario',
  _system_version: '14.04',
  LANGUAGE: 'en_US',
  J2SDKDIR: '/usr/lib/jvm/java-8-oracle',
  LC_TIME: 'it_IT.UTF-8',
  npm_config_user_agent: 'npm/2.14.0 node/v0.12.2 linux x64',
  npm_config_always_auth: '',
  COMP_WORDBREAKS: ' \t\n"\'><;|&(:',
  XDG_SEAT: 'seat0',
  TEXTDOMAIN: 'im-config',
  npm_package_bugs_url: 'https://github.com/720kb/signaler/issues',
  npm_config_bin_links: 'true',
  npm_config_key: '',
  SESSION: 'ubuntu',
  COMPIZ_CONFIG_PROFILE: 'ubuntu',
  npm_config_description: 'true',
  npm_config_fetch_retries: '2',
  npm_config_heading: 'npm',
  npm_config_init_version: '1.0.0',
  npm_config_user: '1000',
  npm_config_if_present: '',
  npm_node_execpath: '/home/dario/.nvm/versions/node/v0.12.2/bin/node',
  SHLVL: '1',
  J2REDIR: '/usr/lib/jvm/java-8-oracle/jre',
  npm_package_files_0: 'src/node/index.js',
  OLDPWD: '/home/dario/git/bitbucket/chat',
  HOME: '/home/dario',
  QT4_IM_MODULE: 'xim',
  npm_package_files_1: 'src/js/signaler.js',
  npm_config_force: '',
  DESKTOP_SESSION: 'ubuntu',
  NVM_NODEJS_ORG_MIRROR: 'https://nodejs.org/dist',
  NVM_BIN: '/home/dario/.nvm/versions/node/v0.12.2/bin',
  npm_package_files_2: 'src/angular/signaler.js',
  npm_package_scripts_precommit: 'npm run-script lint',
  npm_config_cache_min: '10',
  npm_config_init_license: 'ISC',
  GTK_MODULES: 'overlay-scrollbar:unity-gtk-module',
  XDG_SEAT_PATH: '/org/freedesktop/DisplayManager/Seat0',
  npm_config_editor: 'vi',
  npm_config_rollback: 'true',
  npm_config_tag_version_prefix: 'v',
  LC_MONETARY: 'it_IT.UTF-8',
  INSTANCE: '',
  npm_config_cache_max: 'Infinity',
  npm_config_userconfig: '/home/dario/.npmrc',
  DBUS_SESSION_BUS_ADDRESS: 'unix:abstract=/tmp/dbus-H8oWf4RtJM',
  npm_package_devDependencies_husky: '*',
  npm_package_devDependencies_jsonwebtoken: '*',
  npm_package_devDependencies_node_inspector: '*',
  npm_config_tmp: '/tmp',
  npm_config_engine_strict: '',
  npm_config_init_author_name: '',
  npm_config_init_author_url: '',
  COLORTERM: 'gnome-terminal',
  npm_package_description: '',
  npm_package_dependencies_webrtc_adapter_test: '*',
  npm_package_devDependencies_uglifyjs: '*',
  npm_config_depth: 'Infinity',
  npm_config_save_dev: '',
  npm_config_usage: '',
  NVM_PATH: '/home/dario/.nvm/versions/node/v0.12.2/lib/node',
  GNOME_KEYRING_CONTROL: '/run/user/1000/keyring-myL5ic',
  NVM_DIR: '/home/dario/.nvm',
  npm_package_homepage: 'https://github.com/720kb/signaler',
  npm_config___registry_npmjs_org___authToken: '952a41c2-6e12-4daa-ac49-982e8c40912f',
  npm_config_cafile: '',
  npm_config_https_proxy: '',
  QT_QPA_PLATFORMTHEME: 'appmenu-qt5',
  MANDATORY_PATH: '/usr/share/gconf/ubuntu.mandatory.path',
  IM_CONFIG_PHASE: '1',
  SESSIONTYPE: 'gnome-session',
  npm_config_onload_script: '',
  LOGNAME: 'dario',
  GTK_IM_MODULE: 'ibus',
  npm_package_scripts_ng_min: './tasks/banner | xargs -0 -I banner uglifyjs src/js/signaler.js src/angular/signaler.js --preamble banner -c -m --screw-ie8 -p relative --source-map dist/signaler-angular.min.js.map -o dist/signaler-angular.min.js',
  npm_config_rebuild_bundle: 'true',
  npm_config_shell: '/bin/bash',
  npm_config_save_bundle: '',
  rvm_bin_path: '/home/dario/.rvm/bin',
  WINDOWID: '73400331',
  _: '/home/dario/.nvm/versions/node/v0.12.2/bin/npm',
  npm_package_scripts_preversion: 'npm run-script min',
  npm_config_prefix: '/home/dario/.nvm/versions/node/v0.12.2',
  IRBRC: '/home/dario/.rvm/rubies/ruby-2.2.1/.irbrc',
  DEFAULTS_PATH: '/usr/share/gconf/ubuntu.default.path',
  RUBY_VERSION: 'ruby-2.2.1',
  npm_package_scripts_lint: 'eslint -c .eslintrc src && jshint -c .jshintrc --reporter=unix src && jscs -c .jscsrc src',
  npm_config_cache_lock_wait: '10000',
  npm_config_registry: 'https://registry.npmjs.org/',
  npm_config_browser: '',
  npm_config_save_optional: '',
  npm_config_scope: '',
  npm_config_searchopts: '',
  npm_config_versions: '',
  XDG_SESSION_ID: 'c3',
  TERM: 'xterm',
  npm_config_cache: '/home/dario/.npm',
  npm_config_proxy: '',
  GNOME_DESKTOP_SESSION_ID: 'this-is-deprecated',
  npm_package_scripts_min: 'npm run-script js-min && npm run-script ng-min && plato -r -d report -l .jshintrc -t "signaler" src/',
  npm_package_scripts_debug: 'node-debug spec/start-node.js',
  npm_config_searchsort: 'name',
  npm_config_ignore_scripts: '',
  npm_config_version: '',
  npm_package_author_email: 'wouldgo84@gmail.com',
  npm_config_viewer: 'man',
  npm_config_local_address: '',
  PATH: '/home/dario/.nvm/versions/node/v0.12.2/lib/node_modules/npm/bin/node-gyp-bin:/home/dario/git/gh/signaler/node_modules/.bin:/home/dario/.nvm/versions/node/v0.12.2/lib/node_modules/npm/bin/node-gyp-bin:/home/dario/git/gh/signaler/node_modules/.bin:/home/dario/.nvm/versions/node/v0.12.2/lib/node_modules/npm/bin/node-gyp-bin:/home/dario/git/gh/signaler/node_modules/.bin:/home/dario/.nvm/versions/node/v0.12.2/bin:/home/dario/.rvm/gems/ruby-2.2.1/bin:/home/dario/.rvm/gems/ruby-2.2.1@global/bin:/home/dario/.rvm/rubies/ruby-2.2.1/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/usr/lib/jvm/java-8-oracle/bin:/usr/lib/jvm/java-8-oracle/db/bin:/usr/lib/jvm/java-8-oracle/jre/bin:/home/dario/.rvm/bin:/usr/lib/jvm/java-8-oracle/bin:/usr/lib/jvm/java-8-oracle/db/bin:/usr/lib/jvm/java-8-oracle/jre/bin:/home/dario/Android/Sdk/platform-tools:/home/dario/Android/Sdk/tools:/opt/apache-ant/bin:/opt/apache-maven/bin:/home/dario/.rvm/bin:/home/dario/.rvm/bin',
  SELINUX_INIT: 'YES',
  DERBY_HOME: '/usr/lib/jvm/java-8-oracle/db',
  SESSION_MANAGER: 'local/black:@/tmp/.ICE-unix/9165,unix/black:/tmp/.ICE-unix/9165',
  GDM_LANG: 'en_US',
  NVM_IOJS_ORG_MIRROR: 'https://iojs.org/dist',
  NODE: '/home/dario/.nvm/versions/node/v0.12.2/bin/node',
  npm_package_name: 'siglr',
  npm_package_repository_type: 'git',
  npm_package_devDependencies_hapi: '*',
  LC_ADDRESS: 'it_IT.UTF-8',
  XDG_MENU_PREFIX: 'gnome-',
  XDG_SESSION_PATH: '/org/freedesktop/DisplayManager/Session1',
  XDG_RUNTIME_DIR: '/run/user/1000',
  npm_config_color: 'true',
  MY_RUBY_HOME: '/home/dario/.rvm/rubies/ruby-2.2.1',
  COMPIZ_BIN_PATH: '/usr/bin/',
  DISPLAY: ':0',
  npm_package_scripts_js_min: './tasks/banner | xargs -0 -I banner uglifyjs src/js/signaler.js --preamble banner -c -m --screw-ie8 -p relative --source-map dist/signaler.min.js.map -o dist/signaler.min.js',
  npm_config_fetch_retry_mintimeout: '10000',
  LC_TELEPHONE: 'it_IT.UTF-8',
  LANG: 'en_US.UTF-8',
  XDG_CURRENT_DESKTOP: 'Unity',
  npm_package_devDependencies_eslint: '*',
  npm_config_umask: '0002',
  LS_COLORS: 'rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lz=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.axa=00;36:*.oga=00;36:*.spx=00;36:*.xspf=00;36:',
  XMODIFIERS: '@im=ibus',
  XAUTHORITY: '/home/dario/.Xauthority',
  npm_package_main: 'src/node/index.js',
  npm_package_devDependencies_jshint: '*',
  npm_package_gitHead: '42e423ec48ce48511199924c7240f7fc3978bb1f',
  npm_config_fetch_retry_maxtimeout: '60000',
  npm_config_loglevel: 'warn',
  npm_config_message: '%s',
  npm_lifecycle_script: './tasks/banner | xargs -0 -I banner uglifyjs src/js/signaler.js --preamble banner -c -m --screw-ie8 -p relative --source-map dist/signaler.min.js.map -o dist/signaler.min.js',
  XDG_GREETER_DATA_DIR: '/var/lib/lightdm-data/dario',
  SSH_AUTH_SOCK: '/run/user/1000/keyring-myL5ic/ssh',
  npm_package_scripts_test: 'node spec/start-node.js',
  npm_config_ca: '',
  npm_config_cert: '',
  npm_config_global: '',
  npm_config_link: '',
  NVM_IOJS_ORG_VERSION_LISTING: 'https://iojs.org/dist/index.tab',
  SHELL: '/bin/bash',
  LC_NAME: 'it_IT.UTF-8',
  npm_package_version: '2.3.6',
  npm_package_repository_url: 'git+https://github.com/720kb/signaler.git',
  npm_config_unicode: 'true',
  npm_config_access: '',
  npm_config_save: '',
  npm_lifecycle_event: 'js-min',
  rvm_prefix: '/home/dario',
  GDMSESSION: 'ubuntu',
  npm_config_argv: '{"remain":[],"cooked":["run-script","js-min"],"original":["run-script","js-min"]}',
  npm_config_unsafe_perm: 'true',
  npm_config_long: '',
  npm_config_production: '',
  GEM_HOME: '/home/dario/.rvm/gems/ruby-2.2.1',
  _system_type: 'Linux',
  LESSCLOSE: '/usr/bin/lesspipe %s %s',
  npm_config_node_version: '0.12.2',
  npm_config_tag: 'latest',
  LC_MEASUREMENT: 'it_IT.UTF-8',
  npm_package_devDependencies_plato: '*',
  npm_config_git_tag_version: 'true',
  npm_config_shrinkwrap: 'true',
  GPG_AGENT_INFO: '/run/user/1000/keyring-myL5ic/gpg:0:1',
  UPSTART_SESSION: 'unix:abstract=/com/ubuntu/upstart-session/1000/8945',
  LC_IDENTIFICATION: 'it_IT.UTF-8',
  rvm_version: '1.26.11 (latest)',
  TEXTDOMAINDIR: '/usr/share/locale/',
  npm_package_license: 'MIT',
  npm_config_fetch_retry_factor: '10',
  npm_config_proprietary_attribs: 'true',
  npm_config_strict_ssl: 'true',
  npm_config_npat: '',
  npm_config_save_exact: '',
  XDG_VTNR: '7',
  QT_IM_MODULE: 'ibus',
  _system_arch: 'x86_64',
  npm_package_devDependencies_inert: '*',
  npm_config_globalconfig: '/home/dario/.nvm/versions/node/v0.12.2/etc/npmrc',
  npm_config_init_module: '/home/dario/.npm-init.js',
  npm_config_dev: '',
  npm_config_parseable: '',
  PWD: '/home/dario/git/gh/signaler',
  JAVA_HOME: '/usr/lib/jvm/java-8-oracle',
  GEM_PATH: '/home/dario/.rvm/gems/ruby-2.2.1:/home/dario/.rvm/gems/ruby-2.2.1@global',
  npm_config_globalignorefile: '/home/dario/.nvm/versions/node/v0.12.2/etc/npmignore',
  npm_execpath: '/home/dario/.nvm/versions/node/v0.12.2/lib/node_modules/npm/bin/npm-cli.js',
  CLUTTER_IM_MODULE: 'xim',
  XDG_CONFIG_DIRS: '/etc/xdg/xdg-ubuntu:/usr/share/upstart/xdg:/etc/xdg',
  XDG_DATA_DIRS: '/usr/share/ubuntu:/usr/share/gnome:/usr/local/share/:/usr/share/',
  npm_package_author_name: 'Dario Andrei',
  npm_config_cache_lock_retries: '10',
  LC_NUMERIC: 'it_IT.UTF-8',
  _system_name: 'Ubuntu',
  npm_config_save_prefix: '^',
  LC_PAPER: 'it_IT.UTF-8',
  npm_package_dependencies_comunicator: '^2.2.2',
  npm_config_group: '1000',
  npm_config_init_author_email: '',
  npm_config_searchexclude: '',
  MANPATH: '/home/dario/.nvm/versions/node/v0.12.2/share/man:/home/dario/.rvm/rubies/ruby-2.2.1/share/man:/usr/local/man:/usr/local/share/man:/usr/share/man:/usr/lib/jvm/java-8-oracle/man:/home/dario/.rvm/man',
  VTE_VERSION: '3409',
  rvm_path: '/home/dario/.rvm',
  npm_config_git: 'git',
  npm_config_optional: 'true',
  JOB: 'dbus',
  npm_package_devDependencies_jscs: '*',
  npm_config_spin: 'true',
  npm_config_json: '' }
/*
 * siglr - v2.3.6
 *
 * 
 * https://github.com/720kb/signaler
 * MIT license
 * 2015-08-24T19:56:30.472Z
 */


!function(e){"use strict";var n=function(n,a,t){var o,i,r={audio:!0,video:!0},s={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},c={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:23.21.150.121"}]},h={},l={},d={},w={},f={},m={},u={},v="unknown-peer",g=function(n){e.console.error(n)},b=function(n){e.console.error(n)},p=function(n,a,t){e.console.error(n,a,t)},y=function(n){e.console.error(n)},C=function(n){e.console.error(n)},k=function(n){e.console.error(n)},A=function(n){e.console.error(n)},S=function(n,a,t){e.console.info("iceCandidate for",t,"in",a,"successfully added")},T=function(n,a,t){if(n&&a&&t&&t.data){if(("string"==typeof t.data||t.data instanceof String)&&t.data.indexOf("_signaler")>=0)switch(t.data){case"_signaler:got-stream?":i&&f[n]&&f[n][a]&&f[n][a].addStream(i);break;default:e.console.error("Not interesting event atm")}else{var o={payload:t.data,whoami:a,channel:n},r=new e.CustomEvent("signaler:data-arrived",{detail:o});e.dispatchEvent(r)}e.console.debug(t.data)}else e.console.error("Missing mandatory fields <channel>, <who> or data channel event not valid")},E=function(n,a){var t={whoami:a,channel:n},o=new e.CustomEvent("signaler:datachannel-opened",{detail:t});m[n][a]=this,u[n]&&u[n].indexOf(a)>=0&&this.send("_signaler:got-stream?"),e.dispatchEvent(o),e.console.info("Data channel",this,"opened...")},O=function(n,a){var t={whoami:a,channel:n},o=new e.CustomEvent("signaler:datachannel-closed",{detail:t});delete m[n][a],0===Object.keys(m[n])&&delete m[n],e.dispatchEvent(o),e.console.info("Data channel",this,"closed.")},M=function(n,a,t){if(n&&a&&t&&t.channel){var o=p.bind(t.channel,n,a),i=T.bind(t.channel,n,a),r=E.bind(t.channel,n,a),s=O.bind(t.channel,n,a);t.channel.onerror=o,t.channel.onmessage=i,t.channel.onopen=r,t.channel.onclose=s}else e.console.error("Missing mandatory fields <channel>, <who> or event not present")},D=function(n,a,t,o,i){if(e.console.debug("Set local description",i),!i||"offer"!==i&&"answer"!==i)e.console.error("Type not recognized:",i);else{var r={type:i,channel:t};r[i]=o,n.sendTo(a,r,!0)}},I=function(n,a,t,o){var i=D.bind(this,n,t,a,o,"answer");this.setLocalDescription(new e.RTCSessionDescription(o),i,b)},R=function(n,a,t,o){if(e.console.debug("Set remote description",o),o&&"slave"===o){var i=I.bind(this,n,a,t);this.createAnswer(i,C,s)}else o&&"master"===o&&e.console.info("handshake finished")},N=function(n,a,t,o){var i=D.bind(this,n,t,a,o,"offer");this.setLocalDescription(new e.RTCSessionDescription(o),i,b)},P=function(n,a,t,o){var i=R.bind(this,n,a,t,"master");this.setRemoteDescription(new e.RTCSessionDescription(o),i,y)},j=function(n,a,t,o){var i=R.bind(this,n,a,t,"slave");this.setRemoteDescription(new e.RTCSessionDescription(o),i,y)},_=function(n,a,t,o){if(a){if(o.candidate)w[a]||(w[a]={}),w[a][t]||(w[a][t]=[]),w[a][t].push(o.candidate),e.console.trace("generating a candidate");else if(w[a]&&w[a][t]&&Array.isArray(w[a][t])){var i=w[a][t];n.sendTo(t,{type:"use-ice-candidates",channel:a,candidates:i.splice(0,i.length)},!0),e.console.trace("From",n.whoAmI(),"to",t,"-> use candidates",i.length)}}else e.console.error("channel invalid or event.candidate null")},x=function(n,a,t,o){if(o&&o.target&&o.target.signalingState)switch(o.target.signalingState){default:e.console.info("signaling state not interesting atm",o.target.signalingState)}else e.console.error("signaling state changed without event value")},L=function(n,a,t,o){if(o&&o.target&&o.target.iceConnectionState)switch(o.target.iceConnectionState){case"connected":case"completed":var i=new e.CustomEvent("signaler:ready",{detail:{channel:a,whoami:t}});e.dispatchEvent(i);break;default:e.console.info("ice state not interesting atm.",o.target.iceConnectionState)}else e.console.error("ice connection state changed without event value")},q=function(n,a){if(a.stream)for(var t,o,i=Object.keys(f[n]),r=0,s=i.length;s>r;r+=1)t=i[r],f[n][t]===this&&(o=new e.CustomEvent("signaler:stream",{detail:{userid:t,stream:a.stream}}),e.dispatchEvent(o));else e.console.error("No stream arrived")},U=function(n,a){if(a.stream)for(var t,o,i=Object.keys(f[n]),r=0,s=i.length;s>r;r+=1)t=i[r],f[n][t]===this&&(o=new e.CustomEvent("signaler:end",{detail:{userid:t}}),e.dispatchEvent(o));else e.console.error("No stream arrived")},z=function(n,a,t){if(d[a]===n.whoAmI()||i||u[a].indexOf(t)>=0){var o=N.bind(this,n,a,t);this.createOffer(o,g)}else e.console.info("You can not negotiate a p2p connection")},F=function(n,a,t,o){var r,s,c,h,l;if(i||(r=new e.CustomEvent("signaler:my-stream",{detail:{userid:n.whoAmI(),stream:o}}),i=o,e.dispatchEvent(r)),t)f[a][t].addStream(o);else for(s=Object.keys(f[a]),c=0,h=s.length;h>c;c+=1)l=s[c],l&&f[a][l].addStream(o)},V=function(n,a,t,o){var i,r,s,d,w,u,v,g,b,y,C,k,A;f[a]||(f[a]={}),m[a]||(m[a]={}),o?(i=new e.RTCPeerConnection(c,h),b=i.createDataChannel("signaler-datachannel",l),y=p.bind(b,a,t),C=T.bind(b,a,t),k=E.bind(b,a,t),A=O.bind(b,a,t),r=_.bind(i,n,a,t),s=q.bind(i,a),d=U.bind(i,a),w=z.bind(i,n,a,t),u=L.bind(i,n,a,t),v=M.bind(i,a,t),g=x.bind(i,n,a,t),b.onerror=y,b.onmessage=C,b.onopen=k,b.onclose=A,i.onicecandidate=r,i.onaddstream=s,i.onremovestream=d,i.onnegotiationneeded=w,i.oniceconnectionstatechange=u,i.ondatachannel=v,i.onsignalingstatechange=g):(i=new e.RTCPeerConnection(c,h),r=_.bind(i,n,a,t),s=q.bind(i,a),d=U.bind(i,a),w=z.bind(i,n,a,t),u=L.bind(i,n,a,t),v=M.bind(i,a,t),g=x.bind(i,n,a,t),i.onicecandidate=r,i.onaddstream=s,i.onremovestream=d,i.onnegotiationneeded=w,i.oniceconnectionstatechange=u,i.ondatachannel=v,i.onsignalingstatechange=g),f[a][t]=i},Y=function(n,a){a?n.sendTo(v,{type:"create-channel",channel:a},!0):e.console.error("Missing mandatory <channel> parameter.")},B=function(n,a){a?n.sendTo(v,{type:"join-channel",channel:a},!0):e.console.error("Missing mandatory <channel> parameter.")},G=function(n,a,t){if(a){var o;o=d[a]===n.whoAmI()?t?F.bind(this,n,a,t):F.bind(this,n,a,void 0):F.bind(this,n,a,d[a]),i?o(i):e.getUserMedia(r,o,A)}else e.console.error("Missing mandatory field <channel>")},H=function(n,a,t){n&&a&&m&&m[n]&&m[n][a]?m[n][a].send(t):e.console.error("Missing mandatory fields <channel>, <who> or there is no data-channel for user",a,"in channel",n)},J=function(e,n){if(e&&m&&m[e])for(var a,t,o=Object.keys(m[e]),i=o.length,r=0;i>r;r+=1)a=o[r],a&&(t=m[e][a],t&&t.send(n))},K=function(n,a,t){a&&t&&d[a]===n.whoAmI()?(e.isNaN(t)||(t=Number(t)),n.sendTo(t,{type:"approve",channel:a},!0)):e.console.warn("cause","Please review your code")},Q=function(n,a,t){a&&t&&d[a]===n.whoAmI()?(e.isNaN(t)||(t=Number(t)),n.sendTo(t,{type:"un-approve",channel:a},!0)):e.console.warn("cause","Please review your code")},W=function(n,a){if(a&&a.detail&&a.detail.what&&a.detail.what.type){var t,o,r,s=a.detail,c=a.detail.what.type;switch(c){case"do-handshake":s.whoami&&s.what.channel?(d[s.what.channel]=s.who,V(n,s.what.channel,s.whoami,!0)):e.console.error("Missing mandatory fields: <eventArrived.whoami> and <eventArrived.what.channel>");break;case"take-offer":s.whoami&&s.what.channel&&s.what.offer?(f[s.what.channel]&&f[s.what.channel][s.whoami]||(V(n,s.what.channel,s.whoami),d[s.what.channel]=s.whoami),j.call(f[s.what.channel][s.whoami],n,s.what.channel,s.whoami,s.what.offer)):e.console.error("Missing mandatory fields: <eventArrived.whoami>, <eventArrived.what.channel> and <eventArrived.what.offer>");break;case"take-answer":P.call(f[s.what.channel][s.whoami],n,s.what.channel,s.whoami,s.what.answer);break;case"take-candidates":if(s.what.candidates)for(t=0,o=S.bind(f[s.what.channel][s.whoami],n,s.what.channel,s.whoami);t<s.what.candidates.length;t+=1)f[s.what.channel][s.whoami].addIceCandidate(new e.RTCIceCandidate(s.what.candidates[t]),o,k);break;case"initiator-quit":X(n,s.what.channel,!0);break;case"slave-quit":f[s.what.channel]&&f[s.what.channel][s.whoami]&&f[s.what.channel][s.whoami].close(),m[s.what.channel]&&m[s.what.channel][s.whoami]&&m[s.what.channel][s.whoami].close(),delete f[s.what.channel][s.whoami],delete m[s.what.channel][s.whoami];break;case"approved":s.whoami&&s.what.channel?(u[s.what.channel]||(u[s.what.channel]=[]),u[s.what.channel].push(s.whoami),V(n,s.what.channel,s.whoami,!0)):e.console.error("Missing mandatory fields: <eventArrived.whoami> and <eventArrived.what.channel>");break;case"un-approved":s.whoami&&s.what.channel?(r=u[s.what.channel].indexOf(s.whoami),r>=0&&(u[s.what.channel].splice(r,1),f[s.what.channel][s.whoami].close(),m[s.what.channel][s.whoami].close(),delete f[s.what.channel][s.whoami],delete m[s.what.channel][s.whoami])):e.console.error("Missing mandatory fields: <eventArrived.whoami> and <eventArrived.what.channel>");break;case"you-are-un-approved":s.what.channel&&s.what.users?s.what.users.forEach(function(e){f[s.what.channel]&&f[s.what.channel][e]&&(f[s.what.channel][e].removeStream(i),f[s.what.channel][e].close(),m[s.what.channel][e].close(),delete f[s.what.channel][e],delete m[s.what.channel][e])}):e.console.error("Missing mandatory field: <eventArrived.what.channel> and <eventArrived.what.users>");break;default:e.console.error("Event valid but un-manageable. Target:",a.detail)}}else e.console.error("Event arrived is somehow invalid. Target:",a)},X=function(n,a,t){if(a)if(f[a]){for(var o,r=f[a],s=Object.keys(r),c=s.length,h=0;c>h;h+=1)o=s[h],f[a]&&f[a][o]&&f[a][o].close(),m[a]&&m[a][o]&&m[a][o].close();!t&&i&&(i.stop(),i=void 0),delete d[a],delete f[a],delete u[a],n.sendTo(v,{type:"leave-channel",channel:a},!0),e.removeEventListener("comunicator:to-me",W,!1)}else e.console.info("No peers in specified channel",a);else e.console.error("Missing mandatory parameter <channel>")},Z=function(n,a){var t=Y.bind(this,a),o=B.bind(this,a),r=G.bind(this,a),s=H.bind(this),c=J.bind(this),h=K.bind(this,a),l=Q.bind(this,a),d=X.bind(this,a),w=W.bind(this,a),f={userIsPresent:a.userIsPresent,createChannel:t,joinChannel:o,streamOnChannel:r,sendTo:s,broadcast:c,approve:h,unApprove:l,leaveChannel:d};Object.defineProperties(f,{myStream:{get:function(){return i}}}),e.addEventListener("comunicator:to-me",w,!1),n(f)},$=function(e){o.then(Z.bind(this,e))};return n&&e.Comunicator?n instanceof e.Promise?o=n:("string"==typeof n||n instanceof String)&&(o=new e.Comunicator(n)):e.console.error("Missing mandatory <url> parameter or Comunicator (http://github.com/720kb/comunicator) not present."),a&&(r=a),t&&(s=t),e._getPeers=function(){return f},e._getDataChannels=function(){return m},e._getIceCandidates=function(){return w},e._getInititators=function(){return d},e._getApprovedUsers=function(){return u},new e.Promise($.bind(this))};e.Signaler=n}(window);
//# sourceMappingURL=signaler.min.js.map