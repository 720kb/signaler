{"version":3,"sources":["observable-state.js"],"names":[],"mappings":";;;;;;;;;;;;AAEA,IAAM,UAAU,QAAQ,iBAAR,CAAV;AAAN;IACI,KAAK,QAAQ,SAAR,CAAL;IACA,aAAa,OAAO,SAAP,CAAb;IACA,gBAAgB,IAAI,GAAJ,EAAhB;;IAEE;;;AACJ,WADI,eACJ,GAAc;;;0BADV,iBACU;;AAEZ,QAAM,qBAAqB,IAAI,GAAG,UAAH,CAAc,sBAAc;;AAEzD,YAAK,UAAL,IAAmB;AACjB,eAAO,aAAC,MAAD,EAAS,QAAT,EAAmB,KAAnB,EAA6B;;AAElC,iBAAO,QAAP,IAAmB,KAAnB,CAFkC;AAGlC,qBAAW,IAAX,CAAgB;AACd,oBAAQ,OAAR;AACA,wBAFc;WAAhB,EAHkC;AAOlC,iBAAO,IAAP,CAPkC;SAA7B;AASP,0BAAkB,wBAAC,MAAD,EAAS,QAAT,EAAsB;AACtC,cAAM,OAAO,OAAO,QAAP,EAAiB,IAAjB;cACT,OAAO,OAAO,QAAP,EAAiB,IAAjB,CAF2B;;AAItC,iBAAO,OAAO,QAAP,CAAP,CAJsC;;AAMtC,cAAI,SAAS,QAAT,EAAmB;;AAErB,uBAAW,IAAX,CAAgB;AACd,sBAAQ,aAAR;aADF,EAFqB;WAAvB,MAKO;;AAEL,uBAAW,IAAX,CAAgB;AACd,sBAAQ,SAAR;AACA,uBAAS,IAAT;aAFF,EAFK;WALP;AAYA,iBAAO,IAAP,CAlBsC;SAAtB;OAVpB,CAFyD;KAAd,CAAlB,CAiCxB,KAjCwB,EAArB,CAFM;;0EADV,4BAsCI,oBAAY;;AAEhB,UAAM,mCAAmC,mBACtC,SADsC,CAC5B,QAD4B,CAAnC,CAFU;;AAKhB,aAAO,YAAM;;AAEX,yCAAiC,WAAjC,GAFW;OAAN,CALS;KAAZ,GArCM;GAAd;;eADI;;sCAkDc,aAAa;;AAE7B,oBAAc,GAAd,cAA6B,WAA7B,EAA4C,IAAI,KAAJ,CAAU,EAAV,EAAc,KAAK,UAAL,CAAd,CAA5C,EAF6B;;;;sCAKb,aAAa;;AAE7B,aAAO,cAAc,GAAd,cAA6B,WAA7B,CAAP,CAF6B;;;;oCAKf,aAAa;;AAE3B,aAAO,cAAc,GAAd,cAA6B,WAA7B,CAAP,CAF2B;;;;wBAKjB;;AAEV,aAAO,aAAP,CAFU;;;;SAjER;EAAwB,GAAG,UAAH;;AAuE9B,OAAO,OAAP,GAAiB,eAAjB","file":"observable-state.js","sourcesContent":["/*global module,require*/\n\nconst Reflect = require('harmony-reflect') //TODO remove this when V8 49 land in node\n  , Rx = require('rxjs/Rx')\n  , handlerSym = Symbol('handler')\n  , signalerState = new Map();\n\nclass ObservableState extends Rx.Observable {\n  constructor() {\n\n    const internalObservable = new Rx.Observable(subscriber => {\n\n      this[handlerSym] = {\n        'set': (target, property, value) => {\n\n          target[property] = value;\n          subscriber.next({\n            'type': 'added',\n            value\n          });\n          return true;\n        },\n        'deleteProperty': (target, property) => {\n          const user = target[property].user\n            , role = target[property].role;\n\n          delete target[property];\n\n          if (role === 'master') {\n\n            subscriber.next({\n              'type': 'master-quit'\n            });\n          } else {\n\n            subscriber.next({\n              'type': 'removed',\n              'value': user\n            });\n          }\n          return true;\n        }\n      };\n    }).share();\n\n    super(observer => {\n\n      const subscriptionToInternalObservable = internalObservable\n        .subscribe(observer);\n\n      return () => {\n\n        subscriptionToInternalObservable.unsubscribe();\n      };\n    });\n  }\n\n  addChannelInState(channelName) {\n\n    signalerState.set(`channel-${channelName}`, new Proxy({}, this[handlerSym]));\n  }\n\n  getChannelInState(channelName) {\n\n    return signalerState.get(`channel-${channelName}`);\n  }\n\n  containsInState(channelName) {\n\n    return signalerState.has(`channel-${channelName}`);\n  }\n\n  get state() {\n\n    return signalerState;\n  }\n}\n\nmodule.exports = ObservableState;\n"],"sourceRoot":"/source/"}